### Auto Increment와 단점 등등..
 
Auto Increment(이하 AI)는 무조건 써야하는가?에 대한 궁금증으로 시작되었다.

공부해오고 보고 써왔던 거로는 PK에 지정할 때 AI만을 사용해왔기 때문에 궁금증이 생겼던 것이다. 
하지만 `무조건`이라는 말은 없기에 생각해봤는데, 내 지식만으로는 답을 낼 수가 없었다...

그래서 몇몇 이야기를 들었고 추가적으로 궁금했던 사항에 대해서도 이야기를 들을 수 있었다. 간략하게 적어보자면, 

1. AI는 무조건 사용하는 것은 아니다. 정책이나 요구사항에 따라서 충분히 달라질 수 있으나 웬만해서는 권고한다. 하지만 `그게 절대 정답은 아님`
2. AI를 사용함으로써 동시성에 관해 문제는 일어날 수 없다.

사실 첫 의문점으로는 `AI에서 동시성이 일어날 수 있는가?`였다. 만약에 다중서버의 환경에서 PK AI를 사용해
데이터를 동시에 들어온다고 가정할 때, AI는 동시성에 대한 이슈가 일어나는 것일까? 라는 내용이었다.

결론부터 이야기하자면 앞서 이야기`(2)` 했듯이 일어날 수 없다.

왜냐하면 우선 내가 생각했던 그 동시성은 애플리케이션에서 일어나는 거고
실제로 AI를 사용했을 때는 DB(AI가 DB에서 하기에, 생성자가 DB라서 - 번외) MySQL의 경우 AI는 내부적인 THREAD LOCKING을 함)이기에 말이 맞지가 않다.

그리고 사용자(개발자)가 어떤 값으로 지정해달라 하는 것도 아니기 때문에 발생하지 않는다. 더군다나 Duplicate key error도 마찬가지로 같은 얘기이기 때문에 발생하지 않는다.

그렇기 때문에 내가 생각한 동시성은 발생할 수 없다. 그러나 _일반적인 PK나 UK의 경우 동시성이 발생할 수 있다._(어떠한 상황에 발생하는지 생각해봐야겠음)

그리고 AI를 사용했을 때의 단점으로는 내가 언젠가 구글링을 통해서 봤던 기억이 있었는데, 그것이 무엇이냐면
AI로 잡은 KEY가 노출이 된다면 보안상으로 어떤 문제가 생길 수 있다는 것이었다. 그 당시에는 뭔가 그럴듯해서 아하 하고 넘겼는데
오늘 이야기를 들어보니 그렇지도 않다.

그 AI를 사용해서 나오는 PK의 값은 비즈니스와 관계없는 의미없는 숫자일 뿐이라 크게 문제가 되지 않는다는 것이다.
다만 그 서비스의 유저 수라던지? 물품 판매의 수라던지..?이런 것들은 대충 유추는 가능할 수도 있다.

아무튼 그런 것들은 단점이 될 수 없다. 그나마 단점 아닌 단점이라 한다면 분산환경일 때의 불리함이다.
DB 서버 1, 2, 3이 있을 경우 DB 데이터의 정합성을 위해 DB 서버1에 PK값이 1이 늘어난다면 나머지 서버 2, 3도 늘려줘야한다.

물론 다른 방법도 있겠지만 이러한 방식들 때문에 어떤..불리함..?이 존재한다는 것. 관리는 할 수 있으나 어렵다는 점. 근데 위의 방식으로는 보통 안 한다 함.

왜냐하면 시스템 속성을 바꿔야 한다는데 솔직히 무슨 말인지 이건 이해X, 앞에 로드 밸런서나 해시를 기준으로 나누거나 간단하게 UUID를 통해 UK를 사용하면 된다고는 하지만 아직 경험이 없어서 그런가
와닿지는 않는다.

따라서 정리하자면

- 거의 웬만해선 AI를 사용하긴 하나 그것이 정답은 아니다. (사실 DB에 정답은 없다고..) 그 상황에 알맞게 사용하는 것이 중요하다.
- 내가 생각한 동시성은 애플리케이션 단에서의 동시성이다. AI는 DB에서 생성되기 때문에 우리(개발자)가 관여할 건 아님
- 당연한 말이지만 외부에 노출될 것을 PK로 지정해서 노출하면 당연히 위험하다~
- AI의 단점이라기 보단 한계점으로는 분산환경일 때의 AI이다.
- 그리고 AI의 경우 의미없는 값이기 때문에 다른 값으로 교체될 일이 없다.